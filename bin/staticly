#!/usr/bin/env ruby

def verbose?
  ARGV.any? do |arg|
  end
end

current_dir = File.dirname(__FILE__)

app_root = File.expand_path("../..", current_dir)
cli_root = File.expand_path("..", current_dir)

app_code_dir = File.join(app_root, "Staticly")
test_dir = File.join(app_root, "test site")
output_dir = File.join(test_dir, "tmp-output")
cache_dir = File.join(test_dir, "tmp-cache")
site_dir = ARGV[0] || File.join(test_dir, "site")
ruby_dir = File.join(app_root, "vendor/ruby-1.9.3")
vendor_dir = File.join(app_root, "vendor")

$: << app_code_dir
require 'rubygems'

assetfile_dir = File.join(app_code_dir, "Assetfile")

ENV["SASSROOT"] = File.join(vendor_dir, "sass")
ENV["RUBYPATH"] = ruby_dir

Dir.chdir site_dir do
  ARGV[0] = assetfile_dir
  ARGV[1] = output_dir
  ARGV[2] = cache_dir
  load File.join(cli_root, "lib/cli.rb")
end
